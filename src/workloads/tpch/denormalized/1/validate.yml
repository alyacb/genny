SchemaVersion: 2018-07-01
Owner: "@mongodb/product-query"
Description: |
  Validate TPC_H denormalized queries for scale 1.

Clients:
  Default:
    QueryOptions:
      socketTimeoutMS: -1

ActorTemplates:
- TemplateName: ValidateTPCHQueryActorTemplate
  Config:
    Name: &query {^Parameter: {Name: "Query", Default: ""}}
    Type: AssertiveActor
    Database: &db tpch
    Phases:
    - Repeat: 1
      Database: *db
      Expected:
        aggregate: {^Join: {array: ["res_", *query]}}
        pipeline: [{$sort: {num: 1}}]
        cursor: {batchSize: {^Parameter: {Name: "BatchSize", Default: 101}}}
      Actual: {^Parameter: {Name: "Actual", Default: {}}}

# Note: since the queries are all raed-only and we don't care about timing metrics here, we can just run all the queries simultaneously.
Actors:
- ActorFromTemplate:
    TemplateName: ValidateTPCHQueryActorTemplate
    TemplateParameters:
      Query: 1
      Actual: 
        LoadConfig:
          Path: ../../../../phases/tpch/denormalized/Q1.yml
          Key: TPCHDenormalizedQuery1Aggregation
- ActorFromTemplate:
    TemplateName: ValidateTPCHQueryActorTemplate
    TemplateParameters:
      Query: 2
      Actual: 
        LoadConfig:
          Path: ../../../../phases/tpch/denormalized/Q2.yml
          Key: TPCHDenormalizedQuery2Aggregation
